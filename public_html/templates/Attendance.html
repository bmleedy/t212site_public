<script src="js/jquery.js"></script>

<script type="text/javascript">
var user_id;
var selectedPatrolId = null;

$(document).ready(function() {
	user_id = document.getElementById('user_id').value;

	// Display page title and basic structure
	$('#attendanceContent').append('<h3>Attendance Tracker</h3>');
	$('#attendanceContent').append('<p>Welcome to the Attendance Tracker. Select a patrol to view and record attendance.</p>');

	// Add patrol selector section
	$('#attendanceContent').append('<div class="row"><div class="large-12 columns"><label>Select Patrol:</label><select id="patrolSelector"><option value="">Loading patrols...</option></select></div></div>');

	// Load patrols from database
	loadPatrols();

	console.log("Attendance page loaded for user ID: " + user_id);
});

function loadPatrols() {
	$.ajax({
		url: "api/getpatrols.php",
		type: "post",
		datatype: 'json',
		error: function(errorThrown) {
			console.error("Error loading patrols:", errorThrown);
			$('#patrolSelector').html('<option value="">Error loading patrols</option>');
		},
		success: function(data) {
			console.log("Patrols loaded:", data);

			if (data.status === "Success") {
				// Clear the dropdown
				$('#patrolSelector').empty();

				// Add default option
				$('#patrolSelector').append('<option value="">-Select a Patrol-</option>');

				// Add each patrol as an option
				if (data.patrols && data.patrols.length > 0) {
					data.patrols.forEach(function(patrol) {
						$('#patrolSelector').append('<option value="' + patrol.id + '">' + patrol.label + '</option>');
					});
				}

				// Set up change event handler
				$('#patrolSelector').on('change', function() {
					selectedPatrolId = $(this).val();
					console.log("Patrol selected: " + selectedPatrolId);
					// This will be used in the next step to load patrol members
				});
			} else {
				$('#patrolSelector').html('<option value="">Error: ' + (data.message || 'Unknown error') + '</option>');
			}
		}
	});
}
</script>

<div class="row">
	<div class="large-12 columns">
		<div id="attendanceContent"></div>
	</div>
</div>

